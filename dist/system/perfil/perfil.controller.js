define(["../controllers/module"],function(e){"use strict";function t(e,t,o,i,l,n){o.dataStatus={arrayStatusAll:t.status(!0),arrayStatus:t.status(!1)},o.expand=!1,o.showFilter=function(){var e=$("#headerSearch"),t=e.next();t.slideToggle(500,function(){}),o.filterExpand=!o.filterExpand,e.blur()},o.grupo_id_searchConfig={table:"dbo.grupo",fields:[{title:"",labelField:!0,field:"grupo_nome",search:!0,type:"string",filterOperator:"%LIKE%"},{title:"",field:"grupo_id"}]},o.gridControl={},o.gridInit=function(){o.formShow="default",o.dgConfig={table:"dbo.perfil",view:"dbo.vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,visible:!1,title:"ID",field:"per_id",type:"int",identity:!0},{title:"Nome",field:"per_nome",type:"string",filter:"filtro_per_nome",filterOperator:"%LIKE%"},{title:"Status",field:"per_ativo_label",type:"bit",filter:"filtro_per_ativo",filterOperator:"=",filterOptions:{field:"per_ativo",selectedItem:"id"}}]}},o.getData=function(){o.gridControl.getData()},o.remove=function(){o.gridControl.remove()},o.formTitle="Formulário",r.$inject=["perfilService","$scope","$mdDialog","$rootScope"],o.setFormTitle=function(){"default"===o.formShow?"insert"===o.formAction?o.formTitle="Formulário de Adicionar":o.formTitle="Formulário de Editar":"grupo"===o.formShow&&(o.formTitle="Selecione um grupo")},o.add=function(t){o.formAction="insert",o.setFormTitle(),n.show({scope:o,preserveScope:!0,controller:r,templateUrl:e.PX_PACKAGE+"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1})},o.edit=function(t){o.formAction="update",o.formItemEdit=t.itemEdit,o.setFormTitle(),n.show({scope:o,preserveScope:!0,controller:r,templateUrl:e.PX_PACKAGE+"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1})}}function r(e,t,r,o){t.formControl={},t.grupo_id_searchControl={},t.grupo_id_searchClick=function(){t.formShow="grupo",t.setFormTitle()},t.formInit=function(){t.formControl.clean(),t.formConfig={table:"dbo.perfil",view:"dbo.vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,field:"per_id",type:"string",identity:!0},{field:"grupo_id",fieldValueOptions:{selectedItem:"grupo_id"},type:"int",element:"grupo_id"},{field:"per_ativo",labelField:"per_ativo_label",type:"int",element:"per_ativo",fieldValueOptions:{selectedItem:"id",selectedLabel:"name"}},{field:"per_nome",type:"string",element:"per_nome"},{field:"per_master",type:"bit",element:"per_master"},{field:"per_resetarSenha",type:"bit",element:"per_resetarSenha"}]},t.per_ativo=t.dataStatus.arrayStatusAll,"insert"===t.formAction?t.jsTree(0):"update"===t.formAction&&(t.formControl.select(t.formItemEdit),t.jsTree(t.formItemEdit.per_id))},t.formInsert=function(e){t.formControl.insert(),r.hide()},t.formUpdate=function(e){t.formControl.update(),r.hide()},t.formCallback=function(r){var i=o.globals.currentUser.grupo_id;1===o.globals.currentUser.per_developer&&(i=t.grupo_id_searchControl.getValue().selectedItem.grupo_id),"insert"==r.action?(t.gridControl.addDataRow(r.data),e.saveTreeMenu(r.queryResult.IDENTITYCOL,t.jstreeData,function(e){})):"update"==r.action&&(t.gridControl.updateDataRow(r.data),e.saveTreeMenu(r.data.per_id,t.jstreeData,function(e){}))},t.formCancel=function(){"default"===t.formShow?r.cancel():t.formShow="default"},t.formClean=function(){t.formControl.clean()},t.grupo_id_itemClick=function(e){t.formShow="default",t.grupo_id_searchControl.setValue(e.itemClick),t.setFormTitle()},t.jsTree=function(r){$("#jstree").on("changed.jstree",function(e,r){t.jstreeData=r.selected}),e.jsTreeMenu(r,function(e){e.jstree=JSON.parse(JSON.stringify(e.jstree).replace(/,"null"/g,"")),$("#jstree").jstree(e.jstree)})}}e.controller("PerfilCtrl",t),t.$inject=["pxConfig","perfilService","$scope","$element","$attrs","$mdDialog"]});