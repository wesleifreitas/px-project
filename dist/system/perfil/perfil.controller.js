define(["../controllers/module"],function(e){"use strict";function t(e,t,o,i,l){t.dataStatus={arrayStatusAll:e.status(!0),arrayStatus:e.status(!1)},t.expand=!1,t.showFilter=function(){var e=$("#headerSearch"),r=e.next();r.slideToggle(500,function(){}),t.filterExpand=!t.filterExpand,e.blur()},t.grupo_id_searchConfig={table:"dbo.grupo",fields:[{title:"",labelField:!0,field:"grupo_nome",search:!0,type:"string",filterOperator:"%LIKE%"},{title:"",field:"grupo_id"}]},t.gridControl={},t.gridInit=function(){t.formShow="default",t.dgConfig={table:"dbo.perfil",view:"dbo.vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,visible:!1,title:"ID",field:"per_id",type:"int",identity:!0},{title:"Nome",field:"per_nome",type:"string",filter:"filtro_per_nome",filterOperator:"%LIKE%"},{title:"Status",field:"per_ativo_label",type:"bit",filter:"filtro_per_ativo",filterOperator:"=",filterOptions:{field:"per_ativo",selectedItem:"id"}}]}},t.getData=function(){t.gridControl.getData()},t.remove=function(){t.gridControl.remove()},t.formTitle="Formulário",r.$inject=["perfilService","$scope","$mdDialog","$rootScope"],t.setFormTitle=function(){"default"===t.formShow?"insert"===t.formAction?t.formTitle="Formulário de Adicionar":t.formTitle="Formulário de Editar":"grupo"===t.formShow&&(t.formTitle="Selecione um grupo")},t.add=function(e){t.formAction="insert",t.setFormTitle(),l.show({scope:t,preserveScope:!0,controller:r,templateUrl:"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})},t.edit=function(e){t.formAction="update",t.formItemEdit=e.itemEdit,t.setFormTitle(),l.show({scope:t,preserveScope:!0,controller:r,templateUrl:"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})}}function r(e,t,r,o){t.formControl={},t.grupo_id_searchControl={},t.grupo_id_searchClick=function(){t.formShow="grupo",t.setFormTitle()},t.formInit=function(){t.formControl.clean(),t.formConfig={table:"dbo.perfil",view:"dbo.vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,field:"per_id",type:"string",identity:!0},{field:"grupo_id",fieldValueOptions:{selectedItem:"grupo_id"},type:"int",element:"grupo_id"},{field:"per_ativo",labelField:"per_ativo_label",type:"int",element:"per_ativo",fieldValueOptions:{selectedItem:"id",selectedLabel:"name"}},{field:"per_nome",type:"string",element:"per_nome"},{field:"per_master",type:"bit",element:"per_master"},{field:"per_resetarSenha",type:"bit",element:"per_resetarSenha"}]},t.per_ativo=t.dataStatus.arrayStatusAll,"insert"===t.formAction?t.jsTree(0):"update"===t.formAction&&(t.formControl.select(t.formItemEdit),t.jsTree(t.formItemEdit.per_id))},t.formInsert=function(e){t.formControl.insert(),r.hide()},t.formUpdate=function(e){t.formControl.update(),r.hide()},t.formCallback=function(r){var i=o.globals.currentUser.grupo_id;1===o.globals.currentUser.per_developer&&(i=t.grupo_id_searchControl.getValue().selectedItem.grupo_id),"insert"==r.action?(t.gridControl.addDataRow(r.data),e.saveTreeMenu(r.queryResult.IDENTITYCOL,t.jstreeData,function(e){})):"update"==r.action&&(t.gridControl.updateDataRow(r.data),e.saveTreeMenu(r.data.per_id,t.jstreeData,function(e){}))},t.formCancel=function(){"default"===t.formShow?r.cancel():t.formShow="default"},t.formClean=function(){t.formControl.clean()},t.grupo_id_itemClick=function(e){t.formShow="default",t.grupo_id_searchControl.setValue(e.itemClick),t.setFormTitle()},t.jsTree=function(r){$("#jstree").on("changed.jstree",function(e,r){t.jstreeData=r.selected}),e.jsTreeMenu(r,function(e){e.jstree=JSON.parse(JSON.stringify(e.jstree).replace(/,"null"/g,"")),$("#jstree").jstree(e.jstree)})}}e.controller("PerfilCtrl",t),t.$inject=["perfilService","$scope","$element","$attrs","$mdDialog"]});