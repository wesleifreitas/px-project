define(["../controllers/module"],function(e){"use strict";function t(e,t,o,i,l,n,a){i.dataStatus={arrayStatusAll:t.status(!0),arrayStatus:t.status(!1)},i.expand=!1,i.showFilter=function(){var e=$("#headerSearch"),t=e.next();t.slideToggle(500,function(){}),i.filterExpand=!i.filterExpand,e.blur()},i.grupo_id_searchConfig={table:"dbo.grupo",fields:[{title:"",labelField:!0,field:"grupo_nome",search:!0,type:"string",filterOperator:"%LIKE%"},{title:"",field:"grupo_id"}]},i.gridControl={},i.dgConfig={schema:"dbo",table:"perfil",view:"vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,visible:!1,title:"ID",field:"per_id",type:"int",identity:!0},{title:"Nome",field:"per_nome",type:"string",filter:"filtro_per_nome",filterOperator:"%LIKE%"},{title:"Status",field:"per_ativo_label",type:"bit",filter:"filtro_per_ativo",filterOperator:"=",filterOptions:{field:"per_ativo",selectedItem:"id"}}]},o.globals.currentUser.per_master||(i.dgConfig.where=[{field:"per_master",type:"bit",filterOperator:"<>",filterValue:"1"}]),i.gridInit=function(){i.formShow="default"},i.getData=function(){i.gridControl.getData()},i.remove=function(){i.gridControl.remove()},i.formTitle="Formulário",r.$inject=["perfilService","$scope","$mdDialog","$rootScope"],i.setFormTitle=function(){"default"===i.formShow?"insert"===i.formAction?i.formTitle="Formulário de Adicionar":i.formTitle="Formulário de Editar":"grupo"===i.formShow&&(i.formTitle="Selecione um grupo")},i.add=function(t){i.formAction="insert",i.setFormTitle(),a.show({scope:i,preserveScope:!0,controller:r,templateUrl:e.PX_PACKAGE+"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1})},i.edit=function(t){i.formAction="update",i.formItemEdit=t.itemEdit,i.setFormTitle(),a.show({scope:i,preserveScope:!0,controller:r,templateUrl:e.PX_PACKAGE+"system/perfil/perfil-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1})}}function r(e,t,r,o){t.formControl={},t.grupo_id_searchControl={},t.grupo_id_searchClick=function(){t.formShow="grupo",t.setFormTitle()},t.formInit=function(){t.formControl.clean(),t.formConfig={table:"dbo.perfil",view:"dbo.vw_perfil",groupItem:"grupo_id",fields:[{pk:!0,field:"per_id",type:"string",identity:!0},{field:"grupo_id",fieldValueOptions:{selectedItem:"grupo_id"},type:"int",element:"grupo_id"},{field:"per_ativo",labelField:"per_ativo_label",type:"int",element:"per_ativo",fieldValueOptions:{selectedItem:"id",selectedLabel:"name"}},{field:"per_nome",type:"string",element:"per_nome"},{field:"per_master",type:"bit",element:"per_master"},{field:"per_resetarSenha",type:"bit",element:"per_resetarSenha"}]},t.per_ativo=t.dataStatus.arrayStatusAll,"insert"===t.formAction?t.jsTree(0):"update"===t.formAction&&(t.formControl.select(t.formItemEdit),t.jsTree(t.formItemEdit.per_id))},t.formInsert=function(e){t.formControl.insert()},t.formUpdate=function(e){t.formControl.update()},t.formCallback=function(i){var l=o.globals.currentUser.grupo_id;1===o.globals.currentUser.per_developer&&(l=t.grupo_id_searchControl.getValue().selectedItem.grupo_id),"insert"!=i.action||i.error?"update"!=i.action||i.error||(t.gridControl.updateDataRow(i.data),e.saveTreeMenu(i.data.per_id,t.jstreeData,function(e){r.hide()})):(t.gridControl.addDataRow(i.data),e.saveTreeMenu(i.queryResult.IDENTITYCOL,t.jstreeData,function(e){r.hide()}))},t.formCancel=function(){"default"===t.formShow?r.cancel():t.formShow="default"},t.formClean=function(){t.formControl.clean()},t.grupo_id_itemClick=function(e){t.formShow="default",t.grupo_id_searchControl.setValue(e.itemClick),t.setFormTitle()},t.jsTree=function(r){$("#jstree").on("changed.jstree",function(e,r){t.jstreeData=r.selected}),e.jsTreeMenu(r,function(e){e.jstree=JSON.parse(JSON.stringify(e.jstree).replace(/,"null"/g,"")),$("#jstree").jstree(e.jstree)})}}e.controller("PerfilCtrl",t),t.$inject=["pxConfig","perfilService","$rootScope","$scope","$element","$attrs","$mdDialog"]});