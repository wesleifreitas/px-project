define(["../controllers/module"],function(e){"use strict";e.controller("LoginCtrl",["pxCssLoader","$scope","$location","AuthenticationService","FlashService",function(e,i,n,s,a){e.load();var o=this;o.formTitle="Phoenix Project",o.loginMessage="",o.initController=function(){s.ClearCredentials()}(),o.login=function(){"default"===o.selection&&(o.dataLoading=!0,s.Login(o.username,o.password,function(e){if(o.loginMessage=e.message,console.info(e),e.success){if(1===e.qQuery[0].USU_MUDARSENHA)return o.formTitle="Alteração de senha",o.selection="redefine",void(o.id=e.qQuery[0].USU_ID);s.SetCredentials(o.username,o.password,e),n.path("/")}else a.Error(e.message),o.dataLoading=!1,$("#loginDiv").effect("shake",{direction:"left",distance:10,times:3})}))},o.recover=function(){o.dataLoading=!0,alert("recover")},o.redefine=function(){o.dataLoading=!0,s.Redefine(o.id,o.username,o.usu_senha,function(e){e.success?(s.SetCredentials(o.username,o.password,e),n.path("/")):(o.loginMessage=e.message,a.Error(e.message),o.dataLoading=!1,$("#loginDiv").effect("shake",{direction:"left",distance:10,times:3}))})},o.redefineForm=function(){String(o.password)!==String(o.usu_senha_atual)?i.loginForm.usu_senha_atual.$setValidity("confirm",!1):i.loginForm.usu_senha_atual.$setValidity("confirm",!0),String(o.usu_senha)===String(o.password)?i.loginForm.usu_senha.$setValidity("equal",!1):(i.loginForm.usu_senha.$setValidity("equal",!0),String(o.usu_senha)!==String(o.usu_senha_confirmar)?i.loginForm.usu_senha_confirmar.$setValidity("confirm",!1):i.loginForm.usu_senha_confirmar.$setValidity("confirm",!0))},o.recover=function(){o.dataLoading=!0,s.Recover(o.username,o.email,function(e){e.success?(alert("Foi enviado um e-mail para "+o.email+" com as instruções de recuperação de login"),o.showLogin()):(o.loginMessage=e.message,a.Error(e.message),o.dataLoading=!1,$("#loginDiv").effect("shake",{direction:"left",distance:10,times:3}))})},o.showRecover=function(){o.password="",o.loginMessage="",o.formTitle="Esqueci minha senha",o.selection="recover"},o.showLogin=function(){o.password="",o.email="",o.usu_senha_atual="",o.usu_senha="",o.usu_senha_confirmar="",o.loginMessage="",o.formTitle="Login",o.selection="default"},o.selection="default"}])});