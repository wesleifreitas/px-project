define(["../../services/module"],function(e){"use strict";function r(){function e(e,r,t){return r=r||"",t=t||{},t={reverse:t.reverse||!1,usedefaults:t.usedefaults||t.reverse},s(e,r,t)}function r(e,r){for(var t=0,n=r-1,i={escape:!0};n>=0&&i&&i.escape;)i=c[e.charAt(n)],t+=i&&i.escape?1:0,n--;return t>0&&t%2===1}function t(e,r){var t=e.replace(/[^0]/g,"").length,n=r.replace(/[^\d]/g,"").length;return n-t}function n(e,r,t,n){return n&&"function"==typeof n.transform&&(r=n.transform(r)),t.reverse?r+e:e+r}function i(e,r,t){var n=e.charAt(r),a=c[n];return""===n?!1:a&&!a.escape?!0:i(e,r+t,t)}function a(e,r,t){var n=e.split("");return n.splice(t>=0?t:0,0,r),n.join("")}function s(e,s,u){function f(r){if(!m&&i(o,k,A.inc))return!0;if(m||(m=g.length>0),m){var t=g.shift();if(g.push(t),r.reverse&&v>=0)return k++,o=a(o,t,k),!0;if(!r.reverse&&v<e.length)return o=a(o,t,k),!0}return k<o.length&&k>=0}if(!e)return{result:"",valid:!1};e+="";for(var o=s,l=!0,p="",v=u.reverse?e.length-1:0,h=t(o,e),d=!1,g=[],m=!1,A={start:u.reverse?o.length-1:0,end:u.reverse?-1:o.length,inc:u.reverse?-1:1},k=A.start;f(u);k+=A.inc){var L=o.charAt(k),z=e.charAt(v),U=c[L];if(!m||z){if(u.reverse&&r(o,k)){p=n(p,L,u,U),k+=A.inc;continue}if(!u.reverse&&d){p=n(p,L,u,U),d=!1;continue}if(!u.reverse&&U&&U.escape){d=!0;continue}}if(!m&&U&&U.recursive)g.push(L);else{if(m&&!z){U&&U.recursive||(p=n(p,L,u,U));continue}if(g.length>0&&U&&!U.recursive){l=!1;continue}if(!m&&g.length>0&&!z)continue}if(U)if(U.optional){if(U.pattern.test(z)&&h)p=n(p,z,u,U),v+=A.inc,h--;else if(g.length>0&&z){l=!1;break}}else if(U.pattern.test(z))p=n(p,z,u,U),v+=A.inc;else{if(z||!U._default||!u.usedefaults){l=!1;break}p=n(p,U._default,u,U)}else p=n(p,L,u,U),!m&&g.length&&g.push(L)}return{result:p,valid:l}}var u={},c={0:{pattern:/\d/,_default:"0"},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,optional:!0,recursive:!0},S:{pattern:/[a-zA-Z]/},U:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},L:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},$:{escape:!0}};return u.maskFormat=e,u}e.factory("pxMaskUtil",r),r.$inject=[]});