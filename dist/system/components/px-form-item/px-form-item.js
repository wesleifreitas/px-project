define(["../../directives/module"],function(e){"use strict";e.directive("pxEnter",[function(){return function(e,r,n){r.bind("keydown keypress",function(r){13===r.which&&(e.$apply(function(){e.$eval(n.pxEnter)}),r.preventDefault())})}}]).directive("pxValid",["$timeout",function(e){return{restrict:"E",replace:!0,transclude:!1,template:"<small>{{error}}</small>",scope:{field:"@pxField"},link:function(r,n,t){e(r.init,0)},controller:["$scope",function(e){e.init=function(){e.error="";var r=angular.element($("#"+e.field).get(0)),n=angular.element($("#"+e.field)).data("$ngModelController");r.on("blur",function(t){n.$invalid?(console.info("_ngModelCtrl.$error",n.$error),r.css({borderColor:"#DF0707"}),n.$error.required&&e.$apply(function(){e.error="Campo obrigatório"}),console.info("$scope.error",e.error)):(e.error="",r.css({borderColor:"#CCCCCC"}))})}}]}}]).directive("pxValidNumber",[function(){return{require:"?ngModel",link:function(e,r,n,t){t&&(t.$parsers.push(function(e){var r=e.replace(/[^0-9]+/g,"");return e!==r&&(t.$setViewValue(r),t.$render()),r}),r.bind("keypress",function(e){32===e.keyCode&&e.preventDefault()}))}}}]).directive("pxBrCnpjMask",["$compile",function(e){return{priority:100,restrict:"A",scope:{cleanValue:"@cleanValue"},require:"?ngModel",link:function(r,n,t,i){i&&(angular.isDefined(t.uiMask)||(t.$set("uiMask","99.999.999/9999-99"),e(n)(r)),i.$parsers.push(function(e){var r=e.replace(/[^0-9]+/g,"");return e!==r&&i.$setViewValue(r),r}))}}}]).directive("pxBrCpfMask",["$compile",function(e){return{priority:100,restrict:"A",scope:{cleanValue:"@cleanValue"},require:"?ngModel",link:function(r,n,t,i){i&&(angular.isDefined(t.uiMask)||(t.$set("uiMask","999.999.999-99"),e(n)(r)),i.$parsers.push(function(e){var r=e.replace(/[^0-9]+/g,"");return e!==r&&i.$setViewValue(r),r}))}}}]).directive("pxBrPhoneMask",["$compile",function(e){return{priority:100,restrict:"A",scope:{cleanValue:"@cleanValue",validPhone8:"@validPhone8",validPhone9:"@validPhone9"},bindToController:!1,require:"?ngModel",link:function(r,n,t,i){i&&(angular.isDefined(t.uiMask)||(t.$set("uiMask","(99) 9999-9999?9"),e(n)(r)),n.bind("focusout",function(e){(r.cleanValue.length<11||!angular.isDefined(r.validPhone8))&&(t.$set("uiMask","(99) 9999-9999"),i.$setViewValue(r.cleanValue),r.validPhone9=!1,r.validPhone8=!0)}),n.bind("focusin",function(e){angular.isDefined(r.cleanValue)||(r.cleanValue=""),r.cleanValue.length<11&&(t.$set("uiMask","(99) 9999-9999?9"),i.$setViewValue(r.cleanValue),r.validPhone9=!1,r.validPhone8=!1)}),n.bind("keyup",function(e){11===r.cleanValue.length&&r.validPhone9===!1||!angular.isDefined(r.validPhone9)?(t.$set("uiMask","(99) ?99999-9999"),i.$setViewValue(r.cleanValue),r.validPhone9=!0,r.validPhone8=!1):(10===r.cleanValue.length&&r.validPhone8===!1||!angular.isDefined(r.validPhone8))&&(t.$set("uiMask","(99) 9999-9999?9"),i.$setViewValue(r.cleanValue),r.validPhone9=!1,r.validPhone8=!0)}),i.$parsers.push(function(e){var n=e.replace(/[^0-9]+/g,"");return r.cleanValue=n,e!==n&&i.$setViewValue(n),n}))}}}]).directive("pxNumberMask",["$filter","$locale",function(e,r){return{restrict:"A",scope:{cleanValue:"@cleanValue",currency:"=pxCurrency",currencySymbol:"@pxCurrencySymbol",numberSuffix:"@pxNumberSuffix",decimalSeparator:"@pxDecimalSeparator",thousandsSeparator:"@pxThousandsSeparator",numberPrecision:"@pxNumberPrecision",useNegative:"=pxUseNegative",usePositiveSymbol:"=pxUsePositiveSymbol"},require:"?ngModel",link:function(e,n,t,i){function l(e){for(var r="",n=0;n<e.length;n++){var t=e.charAt(n);0===r.length&&"0"===t&&(t=!1),t&&t.match(o)&&(v?r.length<v&&(r+=t):r+=t)}return r}function a(e){if(""===e)return e;for(;e.length<h+1;)e="0"+e;return e}function s(e){if(""===e)return y=!0,e;if(e===c+r.NUMBER_FORMATS.DECIMAL_SEP)return"0";var n=a(l(e)),t="",i=0;0===h&&(d="",s="");var s=n.substr(n.length-h,h),o=n.substr(0,n.length-h);if(n=0===h?o:o+d+s,f||""!==$.trim(f)){for(var u=o.length;u>0;u--){var v=o.substr(u-1,1);i++,i%3===0&&(v=f+v),t=v+t}t.substr(0,1)===f&&(t=t.substring(1,t.length)),n=0===h?t:t+d+s}return!m||0===o&&0===s||(n=-1!==e.indexOf("-")&&e.indexOf("+")<e.indexOf("-")?"-"+n:g?"+"+n:""+n),c&&(n=c+n),p&&(n+=p),n}if(n.css({zIndex:0}),i){var o=/[0-9]/,u=e.pxCurrency||!1,c=e.currencySymbol||"",p=e.numberSuffix||"",d=e.decimalSeparator||r.NUMBER_FORMATS.DECIMAL_SEP,f=e.thousandsSeparator||r.NUMBER_FORMATS.GROUP_SEP,h=Number(e.numberPrecision)||2,m=e.useNegative||!1,g=e.usePositiveSymbol||!1;u&&""===c&&(c=r.NUMBER_FORMATS.CURRENCY_SYM);var v=!1,y=!0;i.$parsers.push(function(e){var r="";return"0"===e||""===e&&y!==!1?"0"===e.trim()&&y===!0?0:(y=!0,""):(r=s(e),e!==r&&(i.$setViewValue(r),i.$render()),isNaN(numeral().unformat(r))?0:numeral().unformat(r))})}}}}]).directive("pxComplete",["pxConfig","pxUtil","$parse","$http","$sce","$timeout",function(e,r,n,t,i,l){return{restrict:"EA",scope:{id:"@id",placeholder:"@placeholder",table:"@pxTable",fields:"@pxFields",orderBy:"@pxOrderBy",recordCount:"@pxRecordCount",selectedItem:"=pxSelectedItem",url:"@pxUrl",responseQuery:"@pxResponseQuery",localQuery:"@pxLocalQuery",inputClass:"@pxInputClass",searchFields:"@searchfields"},require:"?ngModel",templateUrl:e.PX_PACKAGE+"system/components/px-form-item/px-complete.html",link:function(n,i,a,s){if(s){n.lastSearchTerm=null,n.currentIndex=null,n.justChanged=!1,n.searchTimer=null,n.hideTimer=null,n.searching=!1,n.pause=400,n.minLength=3,n.searchStr=null;var o=function(e,r){return e.length>=n.minLength&&e!==r};n.processResults=function(e,r,t){if(e&&e.length>0){n.results=[];for(var i=0;i<e.length;i++){for(var l="",a="",s=0;s<t.length;s++){var o="";t[s].labelField&&(o=e[i][t[s].field],angular.isDefined(o)||(o=e[i][t[s].field.toUpperCase()]),l+=t[s].title+o+" "),t[s].descriptionField&&(o=e[i][t[s].field],angular.isDefined(o)||(o=e[i][t[s].field.toUpperCase()]),a+=t[s].title+o+" ")}var u={title:l,description:a,item:e[i]};n.results[n.results.length]=u}}else n.results=[]},n.searchTimerComplete=function(i){var l=JSON.parse(n.fields);if(i.length>=n.minLength)if(n.localQuery)console.warn("px-complete:","função localQuery não implementada!"),n.searching=!1,n.processResults(JSON.parse(n.localQuery),i);else{angular.forEach(l,function(e){e.search&&(e.filterObject={},e.filterObject={field:e.field,value:r.filterOperator(i,e.filterOperator)})});var a={};a.table=n.table,a.fields=angular.toJson(l),a.orderBy=n.orderBy,angular.isDefined(n.recordCount)&&""!==n.recordCount||(n.recordCount=4),a.rows=n.recordCount,angular.isDefined(n.url)&&""!==n.url||(n.url=e.PX_PACKAGE+"system/components/px-form-item/px-form-item.cfc?method=getData"),t({method:"POST",url:n.url,dataType:"json",params:a}).success(function(e,r,t,a){console.info("response",e),angular.isDefined(n.responseQuery)&&""!==n.responseQuery||(n.responseQuery="qQuery"),n.searching=!1,n.processResults(n.responseQuery?e[n.responseQuery]:e,i,l)}).error(function(e,r,n,t){alert("Ops! Ocorreu um erro inesperado.\nPor favor contate o administrador do sistema!")})}},n.hideResults=function(){n.hideTimer=l(function(){n.showDropdown=!1},n.pause)},n.resetHideResults=function(){n.hideTimer&&l.cancel(n.hideTimer)},n.hoverRow=function(e){n.currentIndex=e},n.keyPressed=function(e){38!==e.which&&40!==e.which&&13!==e.which?n.searchStr&&""!==n.searchStr?o(n.searchStr,n.lastSearchTerm)&&(n.lastSearchTerm=n.searchStr,n.showDropdown=!0,n.currentIndex=-1,n.results=[],n.searchTimer&&l.cancel(n.searchTimer),n.searching=!0,n.searchTimer=l(function(){n.searchTimerComplete(n.searchStr)},n.pause)):(n.showDropdown=!1,n.lastSearchTerm=null):e.preventDefault()},n.selectResult=function(e){n.searchStr=n.lastSearchTerm=e.title,n.selectedItem=e.item,n.showDropdown=!1,n.results=[]};var u=i.find("input");u.on("keyup",n.keyPressed),i.on("keyup",function(e){40===e.which?(n.results&&n.currentIndex+1<n.results.length&&(n.currentIndex++,n.$apply(),e.preventDefault(),e.stopPropagation()),n.$apply()):38===e.which?n.currentIndex>=1&&(n.currentIndex--,n.$apply(),e.preventDefault(),e.stopPropagation()):13===e.which?n.results&&n.currentIndex>=0&&n.currentIndex<n.results.length?(n.selectResult(n.results[n.currentIndex]),n.$apply(),e.preventDefault(),e.stopPropagation()):(n.results=[],n.$apply(),e.preventDefault(),e.stopPropagation()):27===e.which?(n.results=[],n.showDropdown=!1,n.$apply()):8===e.which&&(n.selectedItem=null,n.$apply())})}}}}])});